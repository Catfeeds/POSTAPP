/** 
 @Name : jdate v1.0 日期控件
 @Author:捷讯设计小黑
 @Date: 2016-12-01
 */
var JDate={
	init:function(param){
		var curTime= new Date();
		var $default={
			'minyear':curTime.getFullYear(),
			'maxyear':curTime.getFullYear(),
			'curtime':curTime.getFullYear()+"-"+(curTime.getMonth()+1)+"-"+curTime.getDate(),
		}
		var $opt = $.extend({}, $default, param);
		if(typeof($opt.curtime)=="undefind")$opt.curtime=curTime.getFullYear()+"-"+(curTime.getMonth()+1)+"-"+curTime.getDate();
		var tmp=$opt.curtime.split("-");
		var cur_y=tmp[0],cur_m=tmp[1],cur_d=tmp[2];
		var temp='<section class="__JDatepickermasker"></section><section class="__JDatepickerbox"><div class="__JDatepicker_title"><a href="javascript:;" id="JDateClose">取消</a> <a href="javascript:;" id="JDateSure">确定</a></div><div class="__JDatepicker_mianbox"><div class="__JDatepicker_showbox"></div><div class="__JDatepicker_container"><div class="__JDatepicker_swipercontainer __JDatepicker_swipercontainerbox1"><ul class="swiper-wrapper"></ul></div></div><div class="__JDatepicker_container"><div class="__JDatepicker_swipercontainer __JDatepicker_swipercontainerbox2"><ul class="swiper-wrapper"><li class="swiper-slide">01</li><li class="swiper-slide">02</li><li class="swiper-slide">03</li><li class="swiper-slide">04</li><li class="swiper-slide">05</li><li class="swiper-slide">06</li><li class="swiper-slide">07</li><li class="swiper-slide">08</li><li class="swiper-slide">09</li><li class="swiper-slide">10</li><li class="swiper-slide">11</li><li class="swiper-slide">12</li></ul></div></div><div class="__JDatepicker_container"><div class="__JDatepicker_swipercontainer __JDatepicker_swipercontainerbox3"><ul class="swiper-wrapper"><li class="swiper-slide">01</li><li class="swiper-slide">02</li><li class="swiper-slide">03</li><li class="swiper-slide">04</li><li class="swiper-slide">05</li><li class="swiper-slide">06</li><li class="swiper-slide">07</li><li class="swiper-slide">08</li><li class="swiper-slide">09</li><li class="swiper-slide">10</li><li class="swiper-slide">11</li><li class="swiper-slide">12</li><li class="swiper-slide">13</li><li class="swiper-slide">14</li><li class="swiper-slide">15</li><li class="swiper-slide">16</li><li class="swiper-slide">17</li><li class="swiper-slide">18</li><li class="swiper-slide">19</li><li class="swiper-slide">20</li><li class="swiper-slide">21</li><li class="swiper-slide">22</li><li class="swiper-slide">23</li><li class="swiper-slide">24</li><li class="swiper-slide">25</li><li class="swiper-slide">26</li><li class="swiper-slide">27</li><li class="swiper-slide">28</li><li class="swiper-slide">29</li><li class="swiper-slide">30</li><li class="swiper-slide">31</li></ul></div></div></div></section>';
		$(document.body).append(temp);
		var y_index=0;
		var Yindex=0;
		for(var i=parseInt($opt.minyear);i<=parseInt($opt.maxyear);i++){
			$(".__JDatepicker_swipercontainerbox1 ul").append('<li class="swiper-slide">'+i+'</li>');
			if(cur_y==i)Yindex=y_index;
			y_index++;
		}
		var swiper1 = new Swiper('.__JDatepicker_swipercontainerbox1',{mode:'vertical',initialSlide:Yindex,onTouchEnd:function(){JDatecheckTdata()}});
		var swiper2 = new Swiper('.__JDatepicker_swipercontainerbox2',{mode:'vertical',initialSlide:parseInt(cur_m)-1,onTouchEnd:function(){JDatecheckTdata()}});
		var swiper3 = new Swiper('.__JDatepicker_swipercontainerbox3',{mode:'vertical',initialSlide:parseInt(cur_d)-1,onTouchEnd:function(){JDatecheckTdata()}});
		function JDatecheckTdata(){
			var val_y=$(".__JDatepicker_swipercontainerbox1 li").eq(swiper1.activeIndex).text();
			var val_m=$(".__JDatepicker_swipercontainerbox2 li").eq(swiper2.activeIndex).text();
			var val_d=$(".__JDatepicker_swipercontainerbox3 li").eq(swiper3.activeIndex).text();
			switch(parseInt(val_m)){
				case 4:case 6:case 9:case 11:
					if(parseInt(val_d)==31){
						swiper3.swipeTo(29);
					}
				break;
				case 2:
					if(val_d>28){
						var isRyear=false;
						if (val_y % 4 == 0 && val_y % 100 != 0) {
							isRyear=true
						} else {
							if (val_y % 400 == 0) {
								isRyear=true
							}
						}
						if(isRyear){
							if(val_d>29)swiper3.swipeTo(27);
						}else{
							if(val_d>28)swiper3.swipeTo(26);
						}
					}
					
				break;
			}
		}
		$("#JDateClose").bind("click",function(){
			$(".__JDatepickermasker,.__JDatepickerbox").remove();
			swiper1=swiper2=swiper3=null;
			$(this).unbind("click");
		})
		$("#JDateSure").bind("click",function(){
			var val_y=$(".__JDatepicker_swipercontainerbox1 li").eq(swiper1.activeIndex).text();
			var val_m=$(".__JDatepicker_swipercontainerbox2 li").eq(swiper2.activeIndex).text();
			var val_d=$(".__JDatepicker_swipercontainerbox3 li").eq(swiper3.activeIndex).text();
			if(typeof($opt.target)=="undefind"){
				JDateClose();
			}
			if($($opt.target).is('input')){
				$($opt.target).val(val_y+"-"+val_m+"-"+val_d);
			}else{
				$($opt.target).text(val_y+"-"+val_m+"-"+val_d);
			}
			$(this).unbind("click");
			$(".__JDatepickermasker,.__JDatepickerbox").remove();
			swiper1=swiper2=swiper3=null;
		})
	},
};