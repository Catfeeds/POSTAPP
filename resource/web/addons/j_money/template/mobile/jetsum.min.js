var paycheckcount=0;
var jetsumpay={
	getUserCount:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=getcounterrecord",
			data: {},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback);}
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	printOrder:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'ordersn':param.ordersn,
			'printtype':param.printtype ? param.printtype  : 0,
		}
		$("#print_iframe").removeAttr("src").attr("src",siteroot+"app/index.php?i="+uniacid+"&c=entry&printtype="+$default.printtype+"&m=j_money&do=printer&ordersn="+$default.ordersn);
	},
	paySuccess:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=paysuccess",
			data: {'out_trade_no':$default.out_trade_no},
			success: function(result){
				console.log(result);
				if(typeof($default.success)=='function'){$default.success();}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	payAll:function(param){
		var $default={
			"card_consume":param.card_consume==true ? true : false,
			"password_consume":param.password_consume==true ? true : false,
			"attach":typeof(param.attach)=="undefined" ? "" : param.attach,
		}
		$default = $.extend({}, param);
		if($default.cardid && !$default.card_consume){
			jetsumpay.cardConsume({"cardid":$default.cardid,'success':function(){
				$default.card_consume=true;
				jetsumpay.payAll($default);
			}});
			return;
		}
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=pay_all",
			data: {
				'fee':$default.fee,
				'password':$default.password,
				'qrcode':$default.qrcode,
				'old_trade_no':$default.old_trade_no,
				'attach':$default.attach,
			},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					var out_trade_no=feedback.out_trade_no;
					if(feedback.paywait && feedback.success){
						paycheckcount=0;
						swal({title:"等待客户输入支付密码",showConfirmButton:false});
						setTimeout(function(){
							jetsumpay.reCheckPay({"out_trade_no":out_trade_no,"success":$default.success});
						},4000);
					}else{
						if(typeof($default.success)=='function'){$default.success(out_trade_no);}
					}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	payMember:function(param){
		var $default = {
			"fee":param.fee,
			"password":param.password,
			"cardno":param.cardno,
		};
		if(typeof(param.success)=='function'){$default.success=param.success}
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=pay_member",
			data: {
				'fee':$default.fee,
				'password':$default.password,
				'cardno':$default.cardno,
			},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					var out_trade_no=feedback.out_trade_no;
					if(typeof($default.success)=='function'){$default.success(out_trade_no);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	payMemberPaycode:function(param){
		var $default = {
			"ordersn":param.ordersn,
			"paycode":param.paycode,
		};
		if(typeof(param.success)=='function'){$default.success=param.success}
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=pay_memberpaycode",
			data: {
				'ordersn':$default.ordersn,
				'paycode':$default.paycode,
			},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(typeof($default.success)=='function'){$default.success(feedback);}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	reCheckPay:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=pay_waitpassword",
			data: {'out_trade_no':$default.out_trade_no},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					var out_trade_no=feedback.out_trade_no;
					if(feedback.paywait){
						if(paycheckcount>25)
							{
							  swal("支付失败");
							  return;
							}
						
						paycheckcount++;
						swal({title:"等待客户输入支付密码",showConfirmButton:false});
						setTimeout(function(){
							jetsumpay.reCheckPay({"out_trade_no":out_trade_no,"success":$default.success});
						},3000);
					}else{
						if(typeof($default.success)=='function'){$default.success(out_trade_no);}
					}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	reCheckPay2:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=pay_waitpassword",
			data: {'out_trade_no':$default.out_trade_no},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	checkCard:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=checkcard",
			data: {'code':$default.code},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback.item);}
				}else{
					swal({
						title: feedback.msg,
						}, function(){
							if(typeof($default.falsed)=='function'){$default.falsed(feedback.msg);}
						}
					)
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	cardConsume:function(param){
		var $default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=cardcheck",
			data: {'code':$default.cardid},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback.item);}
				}else{
					swal({
						title: feedback.msg,
						}, function(){
							swal.close();
							if(typeof($default.falsed)=='function'){$default.falsed(feedback.msg);}
						}
					)
				}
				
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	getRefund:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=refundorder",
			data:{"orderid":$default.ordersn},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback.isrefunded);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	getOrder:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=gettradelist",
			data:{"keyword":$default.keyword,"ds":$default.ds,"de":$default.de,"page":$default.page},
			success: function(result){
				if(typeof($default.success)=='function'){$default.success(result);}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	getChargeOrder:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=getchargelist",
			data:{"keyword":$default.keyword,"ds":$default.ds,"de":$default.de,"page":$default.page},
			success: function(result){
				if(typeof($default.success)=='function'){$default.success(result);}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	getMember:function(param){
		var $default = {
			"keyword":param.keyword,
			"page":param.page,
		};
		if(typeof(param.success)=='function'){$default.success=param.success}
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=getmemberlist",
			data:{"keyword":$default.keyword,"page":$default.page},
			success: function(result){
				console.log(result);
				if(typeof($default.success)=='function'){$default.success(result);}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	getOneMember:function(param){
		var $default = {
			"cardno":param.cardno,
		};
		if(typeof(param.success)=='function'){$default.success=param.success}
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=getmemberview",
			data:{"cardno":$default.cardno},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback.item);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	orderExplode:function(param){
		$default = $.extend({}, param);
		$default.op=typeof($default.op)=="undefined" ?  0 : 1 ; 
		window.open(siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=explode&keyword="+$default.keyword+"&ds="+$default.ds+"&de="+$default.de+"&op="+$default.op);
	},
	payQrcode:function(param){
		$default = $.extend({}, param);
		$default.attach=typeof($default.attach)=="undefined" ? "" : $default.attach;
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=payqrcode",
			data:{"fee":$default.fee,'old_trade_no':$default.old_trade_no,'attach':$default.attach,'paytype':$default.paytype},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	rechargeCard:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=rechargecard",
			data:{"cardno":$default.cardno,"fee":$default.fee,"paytype":$default.paytype,"code":$default.code},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(feedback.paywait){
						swal({title:"等待客户输入支付密码",showConfirmButton:false});
						var _ordersn=feedback.out_trade_no;
						setTimeout(function(){
							jetsumpay.reCheckCharge({"out_trade_no":_ordersn,"success":$default.success});
						},4000);
					}else{
						if(typeof($default.success)=='function'){$default.success(result);}
					}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	reCheckCharge:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: siteroot+"app/index.php?i="+uniacid+"&c=entry&m=j_money&do=ajax&op=recharge_waitpass",
			data: {'out_trade_no':$default.out_trade_no},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					var out_trade_no=feedback.out_trade_no;
					if(feedback.paywait){
						swal({title:"等待客户输入支付密码",showConfirmButton:false});
						setTimeout(function(){
							jetsumpay.reCheckCharge({"out_trade_no":out_trade_no,"success":$default.success});
						},4000);
					}else{
						if(typeof($default.success)=='function'){$default.success(out_trade_no);}
					}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
}
function jconfirm(param){
	var $default = {
		"title":param.title,
		"text":typeof(param.text)!='undefined' ? param.text :"",
	};
	if(typeof(param.success)=='function'){$default.success=param.success}
	swal({   
		title: $default.title,
		text: $default.text,
		html:true,
		showCancelButton: true,
		confirmButtonText: "确定",
		cancelButtonText: "取消",
		}, function(isConfirm){
			if (isConfirm){
				if(typeof($default.success)=='function'){$default.success();}
			}
		}
	);
}
function showCounter(){
	if(!$('.sweet-counter-box').size()){
		var temp='<div class="sweet-counter-box"><ul><li>7</li><li>8</li><li>9</li><li class="sweet-counter-b">&larr;</li></ul><ul><li>4</li><li>5</li><li>6</li><li class="sweet-counter-c">C</li></ul><ul><li>1</li><li>2</li><li>3</li></ul><ul><li class="sweet-counter-0">0</li><li>.</li></ul></div>';
		$(".showSweetAlert fieldset").append(temp);
		$(".sweet-counter-box li").on('click',function(){
			var txt=$(this).text();
			if($(this).hasClass("sweet-counter-b"))txt="B";
			Counter(txt,".showSweetAlert input[type='text']");
		});
	}
	if(!$(".showSweetAlert input[type='text']").is(':hidden')){
		$('.sweet-counter-box').removeClass("hide");
		
		var _h=$(".showSweetAlert").css("margin-top");
		$(".showSweetAlert").css("margin-top",-250);
	}else{
		$('.sweet-counter-box').addClass("hide");
	}
}
function changeinputpassword(){
	$(".showSweetAlert input").attr("type","password").focus();
}
function Counter(obj){
	var vTecla=obj;
	var salida=$("#fee");
	if(salida.val().length>8 && vTecla!='清除'){
		return false;	
	}
	if(vTecla=='.'){
		if(salida.val().indexOf('.')>-1){
			salida.val(salida.val());
		}else{
			salida.val(salida.val()+vTecla);
		}
	}else if(vTecla=='清除'){
		salida.val(0);
	}else if(vTecla=='0'){
		if(salida.val()==0 && salida.val().length==1){
			salida.val(0);
		}else{
			salida.val(salida.val()+vTecla);
		}
	}else{
		if((salida.val()==0 && salida.val().length==1)){
			salida.val(vTecla);
		}else{
			salida.val(salida.val()+vTecla);
		} 
	}
	var temp=salida.val();
	if(temp.indexOf('.')>-1){
		var float=temp.split('.');
		if(float[1].length>2){
			salida.val(float[0]+'.'+float[1].substr(0,2));
		}
	}
}

function checkBrowser(){
    var userAgent = navigator.userAgent;
    if (userAgent.indexOf("Chrome") == -1){
		alert("请使用360极速浏览器才能正常");
		return false;
	}
}

