<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head design-width="540">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
	<!-- 优先使用 IE 最新版本和 Chrome -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<!-- 启用360浏览器的极速模式(webkit) -->
	<!-- <link rel="shortcut icon" type="image/ico" href="/favicon.ico"/> -->
	<!-- 添加 favicon icon -->
	<meta name="renderer" content="webkit">
	<title>收银记录</title>
	<link rel="stylesheet" href="css/public.css?ver=1" />
	<script type="text/javascript" src="js/common.js"></script>
	<script src="js/font-size.js"></script>
</head>
<body class="bgf7f7f7">
	<div class="zx-record-t">
		<div class="top">
			<h6 onclick="back()"><img src="img/zx2.png" alt=""></h6>
			<h5><span>收银记录</span><i></i></h5>
			<h4 href="#" onclick="clicked('barcode_pay.html',false,false)">取消</h4>
		</div>
		<div class="midd">
			<h6 class="wl4"><span>总交易笔数</span><i class="listCount"></i></h6>
			<h6><span>总交易金额</span><i class="allTotal"></i></h6>
		</div>
	</div>
	<div class="zx-record-m">
		<ul class="zx-record-ul">

		</ul>
	</div>
	<div class="zx-record-b">
		<ul>
			<li>
				<h6><img class="img1" src="img/hico4.png" alt=""><span>刷卡支付</span></h6>
				<h5 class="card-pay-total">￥0.00</h5>
			</li>
			<li>
				<h6><img class="img2" src="img/zx4.png" alt=""><span>支付宝支付</span></h6>
				<h5 class="ali-pay-total">￥0.00</h5>
			</li>
			<li>
				<h6><img class="img3" src="img/zx3.png" alt=""><span>微信支付</span></h6>
				<h5 class="wx-pay-total">￥0.00</h5>
			</li>
		</ul>
	</div>

	<script src="js/mui.min.js"></script>
	<script src="js/zepto.js"></script>
	<script src="js/event.js"></script>
	<script src="js/touch.js"></script>
	<script src="js/js.js"></script>
	<script type="text/javascript">
		(function($, doc) {
			$.init({
				statusBarBackground: '#f7f7f7'
			});
			$.plusReady(function() {
				var baseUrl = plus.storage.getItem("baseUrl");
				var postUrl = baseUrl + "&c=entry&m=j_money&do=ajax&op=gettradelist";
				var keyword = "";
				var ds      = "";
				var de      = "";
				$.ajax({
					type: "post",
					url: postUrl,
					data: {
						keyword: keyword,
						ds: ds,
						de: de,
						all:1	
					},
					async: true,
					dataType: "json",
					success: function(data) {
//						console.log(data);
						var list = data.list;
						if(data.success == true){
							var list = data.list;
							var outPostData = data.outPostData;
							doc.querySelector(".zx-record-t .top i").innerHTML = outPostData.date;
							doc.querySelector(".listCount").innerHTML = outPostData.listCount;
							doc.querySelector(".allTotal").innerHTML = "￥" + outPostData.allTotal;
							var payListTotal = outPostData.payListTotal;

							for(var j in payListTotal){
//								console.log(payListTotal[j]['paytype'] + "=" + payListTotal[j]['total'])
								switch(payListTotal[j]['paytype']){
									case "0":
										doc.querySelector(".wx-pay-total").innerHTML = payListTotal[j]['total'];
										break;
									case "1":
										doc.querySelector(".ali-pay-total").innerHTML = payListTotal[j]['total'];
										break;
									case "3":
										doc.querySelector(".card-pay-total").innerHTML = payListTotal[j]['total'];
										break;
									default:
										break;
								}
							}
							if(list.length > 0){
								var total = list.length;
								var str = "";
								var cardnum = "";
								for(var i in list){
									var thumb = "";
									var title = "";
									var out_trade_no = list[i]["out_trade_no"];
									out_trade = out_trade_no.substr(out_trade_no.length-4);
									if(list[i]['paytype'] == 0){
										//微信支付
										thumb = "img/zx3.png";
										title = "微信收款";
										cardnum = "<span>订单后四位：</span><i>"+out_trade+"</i>";
									}else if(list[i]['paytype'] == 1){
										//支付宝
										thumb = "img/zx4.png";
										title = "支付宝收款";
										cardnum = "<span>订单后四位：</span><i>"+out_trade+"</i>";
									}else if(list[i]['paytype'] == 3){
										//刷卡
										thumb = "img/hico4.png";
										title = "刷卡收款";
										cardnum = "<span>"+out_trade_no.substr(0,4)+"*******"+out_trade+"</span>";
									}

									var status = "";
									if(list[i]['status'] == 1){
										status = "<span>支付成功</span>";
									}else if(list[i]['status'] == 0){
										status = "<span style='color:red;'>支付失败</span>";
									}else if(list[i]['status'] == 2){
										status = "<span style='color:red;'>已退款</span>";
									}
				
									str += "<li>";
									str += "<div class=\"wrap\">";
									str += "<div class=\"list-l\" data-tradeno=\""+list[i]['out_trade_no']+"\">";
									str += "<h6><img src=\""+thumb+"\" alt=\"\"></h6>";
									str += "<div class=\"wl5\">";
									str += "<h5>"+title+"</h5>";
									str += "<h4><span>"+getDate(list[i]['time'])+"</span>"+cardnum+"</h4>";
									str += "</div>";
									str += "<h3>"+status+"<i>￥"+list[i]['total_fee']+"元</i></h3>";
									str += "</div>";
									str += "<h2 data-tradeno=\""+list[i]['out_trade_no']+"\"><span>打<br>印</span></h2>";
									str += "</div>";
									str += "</li>";
//									console.log(str);
								}
								
								var ularea = doc.querySelector('.zx-record-ul');
								ularea.innerHTML = str;

								mui('.zx-record-m ul li').on('swipeleft','.wrap', function() {
//									console.log('left');
									mui('.zx-record-m ul li .wrap').each(function(){
										this.setAttribute("class","wrap");
									});
									this.setAttribute("class","wrap active");
									var classn = this.getAttribute("class");
//									console.log(classn);

								}).on('swiperight','.wrap', function() {
//									console.log('right');
									this.setAttribute("class","wrap");
								});
								
								mui(".wrap").on("click","h2",function(){
									var out_trade_no = this.getAttribute("data-tradeno");
									console.log(out_trade_no);
								});
								
								mui(".wrap").on("click",".list-l",function(){
									var out_trade_no = this.getAttribute("data-tradeno");
//									console.log(out_trade_no);
									if(out_trade_no){
										localStorage.setItem("out_trade_no",out_trade_no);
										clicked('order_detail.html',false,false);
									}
								});
								
							}
						}else{
							if(data.msg == "请先登录"){
								plus.nativeUI.toast("请先登录");
								clicked('login.html',false,false);
								return;
							}
						}

						function getDate(str){
							return str.split(" ")[0];
						}
					}
				});
			})
		}(mui, document));
	</script>

</body>
</html>

