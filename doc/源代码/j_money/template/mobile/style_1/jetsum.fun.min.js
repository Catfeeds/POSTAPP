var jetsumpay={
	/*登陆*/
	logIn:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'userid':param.userid,
			'pwd':param.pwd,
		}
		if(typeof(param.success)=='function'){$default.success=param.success;}
		if(typeof(param.falsed)=='function'){$default.falsed=param.falsed;}
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=login",
			data: {'userid':$default.userid,'pwd':$default.pwd},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success();}
				}else{
					if(typeof($default.falsed)=='function'){$default.falsed(feedback.msg);}
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	getCountDetail:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
		}
		if(typeof(param.success)=='function'){$default.success=param.success;}
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=gettodaysell",
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback);}
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	payAll:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=trade_payall",
			data: {
				'paytype':$default.paytype,
				'orderfee':$default.orderfee,
				'couponfee':$default.couponfee,
				'discount':$default.discount,
				'totalfee':$default.totalfee,
				'paidfee':$default.paidfee,
				'change':$default.change,
				'cardid':$default.cardid,
				'memberno':$default.memberno,
				'password':$default.password,
				'code':$default.code,
				'discounttype':$default.discounttype,
				'remark':$default.remark,
				'marketing':$default.marketing,
			},
			success: function(result){
				console.log(result);
				
				var feedback=eval("("+result+")");
				if(feedback.success){
					var out_trade_no=feedback.out_trade_no;
					if(feedback.paywait){
						swal({title:"等待客户输入支付密码",showConfirmButton:false});
						setTimeout(function(){
							jetsumpay.reCheckPay({"uniacid":$default.uniacid,"siteroot":$default.siteroot,"out_trade_no":out_trade_no,"success":$default.success});
						},4000);
					}else{
						if(typeof($default.success)=='function'){$default.success(out_trade_no);}
					}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	reCheckPay:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=tradepay_waitpassword",
			data: {'out_trade_no':$default.out_trade_no},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					var out_trade_no=feedback.out_trade_no;
					if(feedback.paywait){
						swal({title:"等待客户输入支付密码",showConfirmButton:false});
						setInterval(function(){
							jetsumpay.reCheckPay({"uniacid":$default.uniacid,"siteroot":$default.siteroot,"out_trade_no":out_trade_no,"success":$default.success});
						},1000);
					}else{
						if(typeof($default.success)=='function'){$default.success(out_trade_no);}
					}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	//卡券查询
	checkCard:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'cardid':param.cardid,
		}
		if(typeof(param.success)=='function'){$default.success=param.success;}
		if(typeof(param.falsed)=='function'){$default.falsed=param.falsed;}
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=checkcard",
			data: {'code':$default.cardid},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback.item);}
				}else{
					swal({
						title: feedback.msg,
						}, function(){
							if(typeof($default.falsed)=='function'){$default.falsed(feedback.msg);}
						}
					)
				}
				
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	//卡券核销
	cardConsume:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'cardid':param.cardid,
		}
		if(typeof(param.success)=='function'){$default.success=param.success;}
		if(typeof(param.falsed)=='function'){$default.falsed=param.falsed;}
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=cardcheck",
			data: {'code':$default.cardid},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback.item);}
				}else{
					swal({
						title: feedback.msg,
						}, function(){
							swal.close();
							if(typeof($default.falsed)=='function'){$default.falsed(feedback.msg);}
						}
					)
				}
				
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	checkMemberCard:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'keyword':param.keyword,
		}
		if(typeof(param.success)=='function'){$default.success=param.success;}
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=seachmembercard",
			data:{"keyword":$default.keyword},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback.item);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	newCard:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'cardno':param.cardno,
			'realname':param.realname,
			'mobile':param.mobile,
			'password':param.password,
		}
		if(typeof(param.success)=='function'){$default.success=param.success;}
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=newmembercard",
			data:{"cardno":$default.cardno,"realname":$default.realname,"mobile":$default.mobile,"password":$default.password},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					swal.close();
					if(typeof($default.success)=='function'){$default.success(feedback.item);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	rechargeCard:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'cardno':param.cardno,
			'fee':param.fee,
			'paytype':param.paytype,
			'code':param.code,
		}
		if(typeof(param.success)=='function'){$default.success=param.success;}
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=rechargecard",
			data:{"cardno":$default.cardno,"fee":$default.fee,"paytype":$default.paytype,"code":$default.code},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(feedback.paywait){
						swal({title:"等待客户输入支付密码",showConfirmButton:false});
						var _ordersn=feedback.out_trade_no;
						setTimeout(function(){
							//读取订单状态
							
						},4000);
					}else{
						if(typeof($default.success)=='function'){$default.success(result);}
					}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	printOrder:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'ordersn':param.out_trade_no,
			'printtype':param.printtype ? param.printtype  : 0,
			'second':param.second ? param.second  : 0,
		}
		$("#print_iframe").removeAttr("src").attr("src",$default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&printtype="+$default.printtype+"&m=j_money&do=printtrade&ordersn="+$default.ordersn+"&second="+$default.second);
	},
	getPrize:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'ordersn':param.ordersn,
		}
		if(typeof(param.success)=='function'){$default.success=param.success;}
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=getprize",
			data:{"ordersn":$default.ordersn},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	getOrder:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'keyword':param.keyword,
			'ds':param.ds,
			'de':param.de,
			'page':param.page,
		}
		if(typeof(param.success)=='function'){$default.success=param.success;}
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=gettradelist",
			data:{"keyword":$default.keyword,"ds":$default.ds,"de":$default.de,"page":$default.page},
			success: function(result){
				//console.log(result);
				if(typeof($default.success)=='function'){$default.success(result);}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	getView:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'keyword':param.keyword,
		}
		if(typeof(param.success)=='function'){$default.success=param.success;}
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=gettradeview",
			data:{"keyword":$default.keyword},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback.item);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	getGoods:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=gettradegoods",
			data: {},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(typeof($default.success)=='function'){$default.success(feedback.item);}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	doExchange:function(param){
		$defaults = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: $defaults.siteroot+"app/index.php?i="+$defaults.uniacid+"&c=entry&m=j_money&do=ajax&op=rotation",
			data:{},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($defaults.success)=='function'){$defaults.success(feedback.fee,feedback.charge,feedback.cardnum);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	paySuccess:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=tradepay_success",
			data: {'out_trade_no':$default.out_trade_no},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback.ordernum);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	tieCard:function(param){
		$default = $.extend({}, param);
		$default.password=typeof(param.password)!="undefined" ? param.password :'';
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=tiecard",
			data:{"cardno":$default.cardno,"code":$default.code,"password":$default.password},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback.item);}
				}else{
					if(feedback.pass){
						$('#modal_tiecard').modal("hide").on('hidden.bs.modal',function (e) {
							swal({
								title:"请输入密码",
								text: "请输入密码<img src='../addons/j_money/template/img/bank.png' onload='changeinputpassword()'/>",
								type: "input",
								html:true,
								showLoaderOnConfirm: true,
								showCancelButton: true,
								confirmButtonText: "确认",
								cancelButtonText: "关闭",
								inputPlaceholder: "请输入密码"
								}, function(inputValue){
									$('.sweet-counter-box').addClass("hide");
									if (inputValue === false) {
										return false;
									}
									if (inputValue === "") {
										swal.showInputError("请输入密码");
										return false
									}
									$default.password=inputValue;
									jetsumpay.tieCard($default);
								}
							)
						});
					}else{
						swal(feedback.msg);
					}
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	seachcardfromid:function(param){
		$default = $.extend({}, param);
		$default.password=typeof(param.password)!="undefined" ? param.password :'';
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=seachcardfromid",
			data:{"id":$default.id},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(typeof($default.success)=='function'){$default.success(feedback.item);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	setdefaultprinter:function(param){
		$default = $.extend({}, param);
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=choseprint",
			data:{"printername":$default.printername,"printerindex":$default.printerindex},
			success: function(result){
				
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
	refund:function(param){
		var $default={
			'uniacid':param.uniacid,
			'siteroot':param.siteroot,
			'ordersn':param.ordersn,
			'fee':param.fee,
			'account':typeof(param.account)!='undefined' ? 1 : 0,
		}
		if(typeof(param.success)=='function'){$default.success=param.success;}
		swal("加载中");
		$.ajax({
			type: "POST",
			url: $default.siteroot+"app/index.php?i="+$default.uniacid+"&c=entry&m=j_money&do=ajax&op=trade_refund",
			data:{"ordersn":$default.ordersn,"refund_fee":$default.fee,"account":$default.account},
			success: function(result){
				console.log(result);
				var feedback=eval("("+result+")");
				if(feedback.success){
					if(feedback.repay){
						$default.account=1;
						jetsumpay.refund($default);
						return;
					}
					if(typeof($default.success)=='function'){$default.success(feedback.item);}
				}else{
					swal(feedback.msg);
				}
			},
			error:function (XMLHttpRequest, textStatus, errorThrown) {
				swal("数据读取失败");
			}
		});
	},
}
function jconfirm(param){
	$default = $.extend({}, param);
	swal({   
		title: $default.title,
		text: typeof($default.text)!='undefined' ? $default.text : '',
		html:true,
		showCancelButton: true,
		confirmButtonText: "确定",
		cancelButtonText: "取消",
		}, function(isConfirm){
			if (isConfirm){
				if(typeof($default.success)=='function'){$default.success();}
			}
		}
	);
}
function payInputBox(param){
	var title_Ary=["应收金额","现金支付","银行卡支付","会员卡支付","卡券核销","使用微信/支付宝支付","支付宝支付","确认收款","发起退款","请输入密码"];
	var text_Ary=["请输入应收金额","请输入收取客户的金额","客户付款后<br>请输入银行卡后4位数字","请输入会员卡号或电话","请输入卡券号码","请扫码客户的付款码","请扫码客户的付款码","确认收款","请输入单号","请输入密码"];
	$default={
		"paytype":param.paytype,
		"fee":param.fee,
		"pass":param.pass ? 1 : 0,
	}
	if(typeof(param.success)=='function'){$default.success=param.success;}
	var paytype=parseInt($default.paytype);
	var fun="showCounter()";
	if($default.pass)fun="changeinputpassword()";
	var temp=$default.fee ? "￥<b class='red'>"+$default.fee+"</b>元":"";
	swal({
		title: title_Ary[paytype]+temp,
		text: text_Ary[paytype]+"<img src='../addons/j_money/template/img/bank.png' onload='"+fun+"'/>",
		type: "input",
		html:true,
		showLoaderOnConfirm: true,
		showNumberForm: true,
		closeOnConfirm: false,
		showCancelButton: true,
		confirmButtonText: "确认",
		cancelButtonText: "关闭",
		inputPlaceholder: text_Ary[paytype] 
		}, function(inputValue){
			$('.sweet-counter-box').addClass("hide");
			if (inputValue === false) {
				return false;
			}
			if (inputValue === "") {
				swal.showInputError(text_Ary[paytype]);
				$('.sweet-counter-box').removeClass("hide");
				return false
			}
			$default.success(inputValue);
	})
}
function showCounter(){
	if(!$('.sweet-counter-box').size()){
		var temp='<div class="sweet-counter-box"><ul><li>7</li><li>8</li><li>9</li><li class="sweet-counter-b">&larr;</li></ul><ul><li>4</li><li>5</li><li>6</li><li class="sweet-counter-c">C</li></ul><ul><li>1</li><li>2</li><li>3</li></ul><ul><li class="sweet-counter-0">0</li><li>.</li></ul></div>';
		$(".showSweetAlert fieldset").append(temp);
		$(".sweet-counter-box li").on('click',function(){
			var txt=$(this).text();
			if($(this).hasClass("sweet-counter-b"))txt="B";
			Counter(txt,".showSweetAlert input[type='text']");
		});
	}
	
	if(!$(".showSweetAlert input[type='text']").is(':hidden')){
		$('.sweet-counter-box').removeClass("hide");
		
		var _h=$(".showSweetAlert").css("margin-top");
		$(".showSweetAlert").css("margin-top",-250);
	}else{
		$('.sweet-counter-box').addClass("hide");
	}
}
function changeinputpassword(){
	$(".showSweetAlert input").attr("type","password");
}
function Counter(num,obj){
	var vTecla=num;
	var salida=$(obj);
	if(vTecla=='C'){
		salida.val('');
		return false;
	}
	if(vTecla=='B'){
		var temp1=salida.val();
		salida.val(temp1.substr(0,temp1.length-1));
		return false;
	}
	if(salida.val().length>8){
		return false;	
	}
	if(vTecla=='.'){
		if(salida.val().indexOf('.')>-1){
			salida.val(salida.val());
		}else{
			salida.val(salida.val()+vTecla);
		}
	}else if(vTecla=='0'){
		if(salida.val()==0 && salida.val().length==1){
			salida.val(0);
		}else{
			salida.val(salida.val()+vTecla);
		}
	}else{
		if((salida.val()==0 && salida.val().length==1)){
			salida.val(vTecla);
		}else{
			salida.val(salida.val()+vTecla);
		} 
	}
	var temp=salida.val();
	if(temp.indexOf('.')>-1){
		var float=temp.split('.');
		if(float[1].length>2){
			salida.val(float[0]+'.'+float[1].substr(0,2));
		}
	}
}

function getrecord(){
	jetsumpay.getCountDetail({"uniacid":uniacid,"siteroot":siteroot,"success":function(data){
		var payall=0;
		var payDetail=[];
		payDetail[0]=payDetail[1]=payDetail[2]=0;
		var list=data.list;
		for(var i in list){
			payall+=parseInt(list[i].fee1);
			if(list[i].paytype==0 || list[i].paytype==1){
				payDetail[0]+=parseInt(list[i].fee1);
			}else if(list[i].paytype==2){
				payDetail[1]+=parseInt(list[i].fee1);
			}else if(list[i].paytype==3){
				payDetail[2]+=parseInt(list[i].fee1);
			}
		}
		var txtary=[payall,payDetail[0],payDetail[1],payDetail[2],data.charge];
		for(var i=0;i<5;i++){
			_num=i+1;
			_tempnum= txtary[i] ? parseInt(txtary[i]/payall*100) : 0;
			_tempnum2=txtary[i] ? (parseInt(txtary[i])*0.01).toFixed(2) : 0;
			if($('#circle_'+_num).size()){
				var radialObj=$('#circle_'+_num).data('radialIndicator');
				radialObj.animate(_tempnum);
				$(".right_showbox li").eq(i).find('.pricenum').html("<small>￥</small> "+_tempnum2);
			}
		}
	}})
}

function checkBrowser(){
    var userAgent = navigator.userAgent;
    if (userAgent.indexOf("Chrome") == -1){
		alert("请使用360极速浏览器才能正常");
		return false;
	}
}

